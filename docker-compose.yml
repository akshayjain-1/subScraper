version: '3.8'

services:
  subscraper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: subscraper
    ports:
      - "8342:8342"
    volumes:
      # Required: Persists all scan data, job history, and configuration
      # This includes completed_jobs.json which keeps job reports visible in dashboard
      - ./recon_data:/app/recon_data
      # Optional: Mount custom wordlists for subdomain brute-forcing
      # - ./wordlists:/app/wordlists
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8342/api/state"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

# Data persistence notes:
# - All application data is stored in ./recon_data/
# - Job history persists in completed_jobs.json (keeps reports visible)
# - Scan results, screenshots, and backups are preserved
# - Configuration settings are maintained across restarts
# - To backup: docker-compose down && tar -czf backup.tar.gz recon_data/
# - To restore: tar -xzf backup.tar.gz && docker-compose up -d
